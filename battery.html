<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NI Homepage Demo - Adaptive Website</title> 
    <!-- Using Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Copied Styles -->
    <style>
        /* Custom NI colors */
        :root {
            --ni-blue: #044123; 
            --ni-green: #044123; 
            --ni-dark-blue: #044123; 
            --ni-light-gray: #f8f9fa;
            --ni-finder-green: #009B65; 
        }
        body {
            font-family: 'Inter', sans-serif;
            color: #333333; 
        }
        .ni-bg-blue { background-color: var(--ni-blue); }
        .ni-text-blue { color: var(--ni-blue); } 
        .ni-bg-dark-blue { background-color: var(--ni-dark-blue); }
        .ni-text-dark-blue { color: var(--ni-dark-blue); }
        
        .ni-bg-green { background-color: var(--ni-green); }
        .ni-text-green { color: var(--ni-green); }
        .ni-border-green { border-color: var(--ni-green); }
        
        .ni-bg-light-gray { background-color: var(--ni-light-gray); }
        .ni-bg-finder-green { background-color: var(--ni-finder-green); } 

        /* Header link style */
        .header-link {
            @apply py-6 border-b-4 border-transparent font-medium; 
            color: #006B46; 
            @apply hover:border-b-4 hover:border-ni-green hover:text-black;
        }
        
        /* Agent Message Container */
        .agent-message-container {
            display: flex;
            align-items: flex-end; 
            margin-bottom: 0.5rem;
            align-self: flex-start;
        }

        /* Agent Avatar */
        .agent-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            margin-right: 8px;
            flex-shrink: 0; 
        }

        /* Chat bubble styles */
        .chat-bubble {
            max-width: 80%;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            line-height: 1.4;
            position: relative; 
        }
        .chat-bubble-agent {
            background-color: #f0f4f8;
            color: #1a202c;
            border-bottom-left-radius: 0.25rem;
        }
        .chat-bubble-user {
            background-color: var(--ni-blue);
            color: white;
            border-bottom-right-radius: 0.25rem;
            align-self: flex-end; 
            margin-bottom: 0.5rem; 
        }
        
        /* Chat options button styles */
        .chat-option {
            background-color: white;
            border: 1px solid var(--ni-blue);
            color: var(--ni-blue);
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            margin: 0.25rem;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .chat-option:hover {
            background-color: var(--ni-blue);
            color: white;
        }

        /* CTA Button Style within chat */
        .cta-button {
             display: inline-block;
             background-color: var(--ni-blue);
             color: white;
             padding: 0.5rem 1.25rem; 
             border-radius: 9999px; 
             margin-top: 0.5rem; 
             font-weight: 500; 
             text-decoration: none;
             transition: background-color 0.2s ease;
        }
        .cta-button:hover {
            opacity: 0.9;
        }

        /* Typing indicator */
        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #909090;
            margin: 0 1px;
            animation: typing-bounce 1s infinite;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing-bounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-4px); }
        }
        
        /* Pulsing button */
        .pulse-button {
            box-shadow: 0 0 0 0 rgba(0, 155, 101, 0.7);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 155, 101, 0.7); }
            70% { box-shadow: 0 0 0 12px rgba(0, 155, 101, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 155, 101, 0); }
        }

        /* Agent Joined Message Style */
        .agent-joined-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 0.75rem; 
        }
        .agent-joined-message {
            font-size: 0.75rem; 
            color: #6b7280; 
        }
        .agent-joined-avatar {
             width: 16px; 
             height: 16px;
             border-radius: 50%;
             margin-right: 4px; 
        }
        
        /* Added for fade-in animation */
         @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        /* NEW: Datasheet button style */
        .datasheet-button {
            display: inline-block;
            border: 1px solid var(--ni-blue);
            color: var(--ni-blue);
            padding: 0.3rem 0.8rem;
            border-radius: 9999px;
            margin-top: 0.75rem; /* Increased margin */
            font-size: 0.75rem; /* text-xs */
            font-weight: 500;
            text-decoration: none;
            transition: all 0.2s ease;
        }
        .datasheet-button:hover {
            background-color: var(--ni-blue);
            color: white;
        }

    </style>
</head>
<body class="bg-white">

    <!-- HEADER -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <div class="flex-shrink-0 flex items-center">
                    <a href="#"><img src="https://ni.scene7.com/is/image/ni/logo_2020?fmt=png-alpha" alt="NI Logo" class="h-8 w-auto"></a>
                </div>
                <div class="hidden lg:flex lg:space-x-8">
                    <a href="#" class="header-link">Solutions</a> <a href="#" class="header-link">Products</a> <a href="#" class="header-link">Industries</a> <a href="#" class="header-link">Shop</a> <a href="#" class="header-link">Support</a> <a href="#" class="header-link">Company</a>
                </div>
                <div class="flex items-center space-x-4">
                    <button class="text-gray-600 hover:text-black"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg></button>
                    <button class="text-gray-600 hover:text-black"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg></button>
                    <button class="text-gray-600 hover:text-black"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg></button>
                    <button class="lg:hidden text-gray-600 hover:text-black"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg></button>
                </div>
            </div>
        </div>
    </header>

    <!-- PAGE CONTENT -->
    <main>
        <!-- Hero Section -->
        <section id="hero-section" class="relative bg-white text-center">
            <img src="https://ni.scene7.com/is/image/ni/AdobeStock_383858917_1440x659?scl=1" alt="NI Hero" class="w-full h-[500px] object-cover">
            <div class="absolute inset-0 flex flex-col items-center justify-center bg-black bg-opacity-30 p-8">
                <h1 class="text-4xl md:text-5xl font-extrabold text-white mb-4 shadow-lg" id="hero-headline">Accelerate Your EV Battery Validation</h1>
                <p class="text-lg md:text-xl text-white max-w-2xl mb-8 shadow-lg" id="hero-subhead">Design and deploy comprehensive test systems for every stage of the battery lifecycle, from R&D to production.</p>
                <a href="#" class="ni-bg-green text-white font-bold py-3 px-8 rounded-full text-lg hover:opacity-90 transition-opacity">Explore EV Test Solutions</a>
            </div>
        </section>

        <!-- Featured Solutions Section -->
        <section class="py-16 ni-bg-light-gray">
            <div class="container mx-auto px-6 lg:px-8">
                <h2 class="text-3xl font-bold text-center mb-12">Test and Measurement Solutions</h2> 
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                    <div class="bg-white rounded-lg shadow-lg overflow-hidden border-2 ni-border-green">
                        <div class="p-6"><h3 class="text-xl font-semibold mb-3">EV Battery Test</h3> <p class="ni-text-blue mb-4">Validate performance and reliability for all your battery test needs.</p> <a href="#" class="font-medium ni-text-blue hover:underline">Learn More &rarr;</a> </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                        <div class="p-6"><h3 class="text-xl font-semibold mb-3">Semiconductor Test</h3> <p class="ni-text-blue mb-4">Lower the cost of test for RF, mixed-signal, and MEMS devices.</p> <a href="#" class="font-medium ni-text-blue hover:underline">Learn More &rarr;</a> </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                        <div class="p-6"><h3 class="text-xl font-semibold mb-3">Wireless Research (6G)</h3> <p class="ni-text-blue mb-4">Rapidly prototype and validate next-generation wireless systems.</p> <a href="#" class="font-medium ni-text-blue hover:underline">Learn More &rarr;</a> </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                        <div class="p-6"><h3 class="text-xl font-semibold mb-3">Autonomous Driving</h3> <p class="ni-text-blue mb-4">Validate your ADAS and AD systems with open, data-driven test.</p> <a href="#" class="font-medium ni-text-blue hover:underline">Learn More &rarr;</a> </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Case Study Section -->
        <section class="py-16 bg-white">
            <div class="container mx-auto px-6 lg:px-8">
                <div class="flex flex-col md:flex-row items-center bg-gray-50 rounded-lg shadow-xl overflow-hidden">
                    <div class="w-full md:w-1/2"><img src="https://cf-images.us-east-1.prod.boltdns.net/v1/static/1326282160001/dd23ea4c-eb09-42db-9420-b63b621356f1/caf1bda9-861c-42cf-b6a3-ac2d57b47f3c/1280x720/match/image.jpg" alt="Automotive OEM" class="w-full h-full object-cover"></div>
                    <div class="w-full md:w-1/2 p-8 md:p-12">
                        <h3 class="text-sm font-bold uppercase ni-text-green mb-2">Customer Success Story</h3> 
                        <h2 class="text-3xl font-bold mb-4">How a Major Auto OEM Validates Battery Packs with NI</h2> 
                        <p class="text-lg ni-text-blue mb-6">See how our PXI-based systems and regenerative cyclers helped a leading automaker reduce battery validation test time by 30% and accelerate their time-to-market.</p> 
                        <a href="#" class="ni-bg-blue text-white font-bold py-3 px-6 rounded-full text-base hover:opacity-90 transition-opacity">Read the Case Study</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Other NI Content -->
        <section class="py-16 ni-bg-light-gray">
            <div class="container mx-auto px-6 lg:px-8">
                <h2 class="text-3xl font-bold text-center mb-12">Explore Our Products</h2> 
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="bg-white rounded-lg shadow-lg p-6"><h3 class="text-xl font-semibold mb-3">PXI Platform</h3> <p class="ni-text-blue">A modular, high-performance platform for automated test and measurement.</p> </div>
                    <div class="bg-white rounded-lg shadow-lg p-6"><h3 class="text-xl font-semibold mb-3">LabVIEW</h3> <p class="ni-text-blue">A graphical programming environment for test, measurement, and control.</p> </div>
                    <div class="bg-white rounded-lg shadow-lg p-6"><h3 class="text-xl font-semibold mb-3">TestStand</h3> <p class="ni-text-blue">Ready-to-run test management software for test sequence development.</p> </div>
                </div>
            </div>
        </section>
    </main>

    <!-- FOOTER -->
     <footer class="ni-bg-dark-blue text-[#32EB96] pt-16 pb-8"> 
        <div class="container mx-auto px-6 lg:px-8">
            <div class="grid grid-cols-2 md:grid-cols-5 gap-8">
                <div><h4 class="font-bold text-lg mb-4">PRODUCTS</h4> <ul class="space-y-2 text-sm"> <li><a href="#" class="hover:underline">PXI</a></li> <li><a href="#" class="hover:underline">LabVIEW</a></li> <li><a href="#" class="hover:underline">TestStand</a></li> <li><a href="#" class="hover:underline">Data Acquisition (DAQ)</a></li> <li><a href="#" class="hover:underline">Software Defined Radios</a></li> </ul> </div>
                <div><h4 class="font-bold text-lg mb-4">INDUSTRIES</h4> <ul class="space-y-2 text-sm"> <li><a href="#" class="hover:underline">Aerospace and Defense</a></li> <li><a href="#" class="hover:underline">Automotive</a></li> <li><a href="#" class="hover:underline">Semiconductor</a></li> <li><a href="#" class="hover:underline">Electronics</a></li> <li><a href="#" class="hover:underline">Government</a></li> </ul> </div>
                <div><h4 class="font-bold text-lg mb-4">SUPPORT</h4> <ul class="space-y-2 text-sm"> <li><a href="#" class="hover:underline">Drivers</a></li> <li><a href="#" class="hover:underline">Manuals</a></li> <li><a href="#" class="hover:underline">Contact Support</a></li> <li><a href="#" class="hover:underline">Product Lifecycle</a></li> </ul> </div>
                <div><h4 class="font-bold text-lg mb-4">COMPANY</h4> <ul class="space-y-2 text-sm"> <li><a href="#" class="hover:underline">About NI</a></li> <li><a href="#" class="hover:underline">Careers</a></li> <li><a href="#" class="hover:underline">Investor Relations</a></li> <li><a href="#" class="hover:underline">Newsroom</a></li> </ul> </div>
                <div><h4 class="font-bold text-lg mb-4">NI Community</h4> <ul class="space-y-2 text-sm"> <li><a href="#" class="hover:underline">Discussion Forums</a></li> <li><a href="#" class="hover:underline">NI Community Home</a></li> </ul> </div>
            </div>
            <hr class="border-t border-[#32EB96] opacity-30 my-8"> 
            <div class="flex flex-col md:flex-row justify-between items-center text-sm text-[#32EB96] opacity-70"> 
                <div class="flex space-x-4 mb-4 md:mb-0"><a href="#" class="hover:underline">Legal</a> <a href="#" class="hover:underline">Privacy</a> <a href="#" class="hover:underline">Cookie Policy</a></div>
                <p>&copy; 2025 National Instruments. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- AGENTIC INITIATION COMPONENT (Hidden by default) -->
    <div id="solution-finder-trigger" class="fixed bottom-8 right-8 z-50 hidden"> 
        <button class="pulse-button ni-bg-finder-green text-white font-bold py-4 px-6 rounded-full shadow-2xl text-lg flex items-center">
            <svg class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" /></svg>
            NI Solution Finder
        </button>
    </div>

    <!-- 
      UPDATED DEMO CONTAINER with Recommendations Panel
    -->
    <div id="demo-container" class="hidden fixed inset-0 bg-black bg-opacity-50 z-[100] flex items-center p-4 md:p-8">
        <!-- Combined Container: Initial narrow width, transitions added -->
        <div id="combined-panels-container" class="flex h-[60vh] w-full md:w-2/5 max-w-2xl bg-white rounded-xl shadow-2xl overflow-hidden relative ml-auto transition-all duration-500 ease-out"> 
            
            <!-- Recommendations Panel: Initial narrow width, transitions added -->
            <div id="recommendations-panel" class="w-1/2 border-r border-gray-200 p-4 overflow-y-auto transition-all duration-500 ease-out transform -translate-x-full bg-gray-50">
                <h3 class="text-lg font-semibold ni-text-blue mb-4 sticky top-0 bg-gray-50 pb-2">Recommendations</h3>
                <!-- Content div -->
                 <div id="recommendations-content">
                    <!-- Initial Content Populated by JS -->
                </div>
            </div>

            <!-- Chat Panel: Initial narrow width, transitions added -->
            <div id="chat-panel" class="w-1/2 flex flex-col h-full transition-all duration-500 ease-out">
                <!-- Chat Header -->
                 <div class="p-4 border-b border-gray-200">
                    <h2 class="text-xl font-semibold ni-text-blue">NI Solution Finder</h2>
                    <p class="text-sm text-gray-600">Powered by Agentforce</p>
                </div>
                <!-- Chat Messages -->
                <div id="chat-messages" class="flex-1 p-4 space-y-4 overflow-y-auto flex flex-col">
                    <!-- Messages will be injected here by JS -->
                </div>
                <!-- Chat Options -->
                <div id="chat-options" class="p-4 bg-gray-50 flex flex-wrap justify-center">
                    <!-- Options will be injected here by JS -->
                </div>
                <!-- Text Input Bar -->
                <div id="chat-input-bar" class="p-4 bg-white border-t border-gray-200">
                    <form id="chat-form" class="flex space-x-3">
                        <input type="text" id="chat-input" placeholder="Type your message..." class="flex-1 border-gray-300 rounded-full shadow-sm p-2 px-4 focus:outline-none focus:ring-2 focus:ring-ni-blue" autocomplete="off">
                        <button type="submit" class="ni-bg-blue text-white rounded-full p-0 w-10 h-10 flex items-center justify-center flex-shrink-0 hover:opacity-90">
                            <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="transform: rotate(90deg);">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"/>
                            </svg>
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Close Button -->
            <button onclick="resetDemo()" class="absolute top-2 right-2 text-gray-600 hover:text-black z-10">
                <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>

        </div>
    </div>

    <!-- 
      DEMO JAVASCRIPT: Updated step logic
    -->
    <script>
        // --- Demo State Management ---
        const chatMessages = document.getElementById('chat-messages');
        const chatOptions = document.getElementById('chat-options');
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
        const agentAvatarUrl = 'https://www.ni.com/favicon-32x32.png'; 
        let currentStep = 0; 
        const heroHeadline = document.getElementById('hero-headline'); 
        const heroSubhead = document.getElementById('hero-subhead'); 
        const recommendationsPanel = document.getElementById('recommendations-panel'); 
        const recommendationsContent = document.getElementById('recommendations-content'); 
        const combinedPanelsContainer = document.getElementById('combined-panels-container'); 
        const chatPanel = document.getElementById('chat-panel'); 
        
        // --- Demo Flow Logic ---
        
        function startDemo() {
            document.getElementById('solution-finder-trigger').classList.add('hidden');
            document.getElementById('demo-container').classList.remove('hidden');
            recommendationsContent.innerHTML = getInitialRecommendationsHTML(); // Set initial recs
            runStep(1.5); 
            resetPanelWidths(); 
            setTimeout(() => { recommendationsPanel.classList.remove('-translate-x-full'); }, 300); 
        }
        
        function resetDemo() {
            document.getElementById('demo-container').classList.add('hidden');
            recommendationsPanel.classList.add('-translate-x-full'); 
            recommendationsContent.innerHTML = getInitialRecommendationsHTML(); 
            resetPanelWidths();
            chatMessages.innerHTML = '';
            chatOptions.innerHTML = '';
            chatInput.value = ''; 
            initializePersonalization(); 
        }

        // --- Helper to reset widths ---
        function resetPanelWidths() {
            combinedPanelsContainer.classList.remove('md:w-3/5', 'max-w-4xl');
            combinedPanelsContainer.classList.add('md:w-2/5', 'max-w-2xl');
            recommendationsPanel.classList.remove('w-2/3');
            recommendationsPanel.classList.add('w-1/2');
            chatPanel.classList.remove('w-1/3');
            chatPanel.classList.add('w-1/2');
        }

        // --- Get current time ---
        function getCurrentTime() {
            return new Date().toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' });
        }
        
        // --- Add Agent Joined Message ---
        function addAgentJoinedMessage() { /* ... function exists but not called ... */ }

        // --- Show Thinking Indicator ---
        function showThinkingIndicator() {
            const container = document.createElement('div');
            container.className = 'agent-message-container'; 
            const avatar = document.createElement('img');
            avatar.src = agentAvatarUrl; avatar.alt = "Agent Avatar"; avatar.className = 'agent-avatar';
            container.appendChild(avatar);
            const msg = document.createElement('div');
            msg.className = 'chat-bubble chat-bubble-agent'; 
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'typing-indicator'; 
            typingIndicator.innerHTML = '<span></span><span></span><span></span>';
            msg.appendChild(typingIndicator);
            const timestampSpan = document.createElement('span');
            timestampSpan.className = 'block text-xs text-gray-500 mt-1'; 
            timestampSpan.textContent = getCurrentTime();
            msg.appendChild(timestampSpan);
            
            container.appendChild(msg);
            chatMessages.appendChild(container); 
            scrollToBottom();
            return container; 
        }

        // --- Typing Simulation ---
        function typeAgentMessage(fullText, onComplete, indicatorElementToRemove = null, onTypingStart = null) {
            const container = document.createElement('div'); container.className = 'agent-message-container';
            const avatar = document.createElement('img'); avatar.src = agentAvatarUrl; avatar.alt = "Agent Avatar"; avatar.className = 'agent-avatar'; container.appendChild(avatar);
            const msg = document.createElement('div'); msg.className = 'chat-bubble chat-bubble-agent'; container.appendChild(msg);
            const contentDiv = document.createElement('div'); 
            if (!indicatorElementToRemove) { 
                const typingIndicator = document.createElement('div'); typingIndicator.className = 'typing-indicator'; typingIndicator.innerHTML = '<span></span><span></span><span></span>'; contentDiv.appendChild(typingIndicator); 
            }
            msg.appendChild(contentDiv);
            chatMessages.appendChild(container); scrollToBottom();
            let i = 0; const typingSpeed = 30; 
            
            function typeChar() {
                if (i < fullText.length) {
                    if (i === 0) {
                        if (indicatorElementToRemove) indicatorElementToRemove.remove();
                        // Execute onTypingStart right when typing begins
                        if (onTypingStart) onTypingStart(); 
                        contentDiv.innerHTML = ''; 
                    }
                    contentDiv.innerHTML += fullText.charAt(i); i++;
                    scrollToBottom(); setTimeout(typeChar, typingSpeed);
                } else {
                    const timestampSpan = document.createElement('span'); timestampSpan.className = 'block text-xs text-gray-500 mt-1'; timestampSpan.textContent = getCurrentTime(); msg.appendChild(timestampSpan);
                    scrollToBottom(); 
                    if (onComplete) { setTimeout(onComplete, 50); }
                }
            }
            // Use minimal delay if removing indicator, else standard delay
            const startDelay = indicatorElementToRemove ? 50 : 1000; 
            setTimeout(typeChar, startDelay); 
        }

        // --- Add Standard Agent Message ---
        function addAgentMessage(text) {
             // ... (no changes) ...
            const container = document.createElement('div'); container.className = 'agent-message-container';
            const avatar = document.createElement('img'); avatar.src = agentAvatarUrl; avatar.alt = "Agent Avatar"; avatar.className = 'agent-avatar'; container.appendChild(avatar);
            const msg = document.createElement('div'); msg.className = 'chat-bubble chat-bubble-agent';
            const contentDiv = document.createElement('div'); contentDiv.innerHTML = text; msg.appendChild(contentDiv);
            const timestampSpan = document.createElement('span'); timestampSpan.className = 'block text-xs text-gray-500 mt-1'; timestampSpan.textContent = getCurrentTime(); msg.appendChild(timestampSpan);
            container.appendChild(msg); chatMessages.appendChild(container); scrollToBottom();
        }

        // --- Add Agent Message with CTA ---
        function addCTAMessage(text, ctaText, ctaLink) {
             // ... (no changes) ...
            const container = document.createElement('div'); container.className = 'agent-message-container';
            const avatar = document.createElement('img'); avatar.src = agentAvatarUrl; avatar.alt = "Agent Avatar"; avatar.className = 'agent-avatar'; container.appendChild(avatar);
            const msg = document.createElement('div'); msg.className = 'chat-bubble chat-bubble-agent';
            const contentDiv = document.createElement('div'); 
            if (text && text.trim().length > 0) contentDiv.innerHTML = text; 
            const ctaLinkElement = document.createElement('a'); ctaLinkElement.href = ctaLink; ctaLinkElement.textContent = "EV Battery Testing Solutions"; ctaLinkElement.className = 'cta-button'; ctaLinkElement.target = "_self"; 
            if (text && text.trim().length > 0) contentDiv.appendChild(document.createElement('br')); 
            contentDiv.appendChild(ctaLinkElement); msg.appendChild(contentDiv);
            const timestampSpan = document.createElement('span'); timestampSpan.className = 'block text-xs text-gray-500 mt-1'; timestampSpan.textContent = getCurrentTime(); msg.appendChild(timestampSpan);
            container.appendChild(msg); chatMessages.appendChild(container); scrollToBottom();
        }

        // --- Add User Message ---
        function addUserMessage(text) {
             // ... (no changes) ...
            const msg = document.createElement('div'); msg.className = 'chat-bubble chat-bubble-user';
            const contentDiv = document.createElement('div'); contentDiv.innerHTML = text; msg.appendChild(contentDiv);
            const timestampSpan = document.createElement('span'); timestampSpan.className = 'block text-xs text-white opacity-70 mt-1'; timestampSpan.textContent = getCurrentTime(); msg.appendChild(timestampSpan);
            chatMessages.appendChild(msg); scrollToBottom();
        }

        // --- Show Buttons ---
        function showOptions(options) {
             // ... (no changes) ...
            scrollToBottom(); 
            setTimeout(() => {
                chatOptions.innerHTML = ''; 
                options.forEach(option => {
                    const btn = document.createElement('button'); btn.className = 'chat-option'; btn.innerHTML = option.text;
                    btn.onclick = () => handleOption(option.nextStep, option.text); 
                    chatOptions.appendChild(btn);
                });
                 scrollToBottom();
            }, 100); 
        }
        
        // --- Handle Button Clicks ---
        function handleOption(nextStep, userText) { 
            addUserMessage(userText);
            chatOptions.innerHTML = '<p class="text-sm text-gray-500 italic">Thinking...</p>';
            if (currentStep === 1.6) {
                 updateRecommendationsAndContinueChat(); 
            } else if (currentStep === 2) { 
                 showSpecsAndFinalRecs(); 
            } else { 
                 setTimeout(() => { runStep(nextStep); }, 1200);
            }
        }

        // --- Handle Text Input ---
        function handleFormSubmit(event) {
            event.preventDefault();
            const text = chatInput.value.trim();
            if (!text) return; 
            addUserMessage(text);
            chatInput.value = '';
            chatOptions.innerHTML = '<p class="text-sm text-gray-500 italic">Thinking...</p>';
            
             if (currentStep === 1.6) { 
                 updateRecommendationsAndContinueChat(); 
             } else if (currentStep === 2) { 
                 showSpecsAndFinalRecs(); 
             } else { 
                 setTimeout(() => {
                    addAgentMessage("Thanks for your message! For this click-through demo, please use the buttons to navigate the conversation path.");
                    if (currentStep >= 32) runStep(99); 
                    else if (currentStep >= 2) runStep(2); // If user types during pause after step 2, maybe just wait? Or re-offer options? Re-offering step 2 options for now.
                    else if (currentStep >= 1.6) runStep(1.6); 
                 }, 1200);
             }
        }
        
        chatForm.addEventListener('submit', handleFormSubmit);
        
        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // --- Helper Functions for Recommendation HTML ---
        function getInitialRecommendationsHTML() {
            // Returns HTML for the first 2 recommendations
            return `
                <div class="mb-6 animate-fade-in"> <img src="https://ni.scene7.com/is/image/ni/AdobeStock_109562868_690x368?scl=1" alt="EV Battery Test" class="w-full h-32 object-cover rounded mb-2 shadow"> <h4 class="font-semibold text-gray-800">Electric Vehicle Battery Test</h4> <p class="text-sm ni-text-blue mb-1">Explore solutions for battery validation across the entire lifecycle.</p> <a href="#" class="text-sm font-medium ni-text-blue hover:underline">Learn More &rarr;</a> </div>
                <div class="mb-4 animate-fade-in" style="animation-delay: 0.2s;"> <img src="https://ni.scene7.com/is/image/ni/Triphase_04_690x368?scl=1" alt="High Power EV Test" class="w-full h-32 object-cover rounded mb-2 shadow"> <h4 class="font-semibold text-gray-800">High Power Electric Vehicle Test</h4> <p class="text-sm ni-text-blue mb-1">Test high-voltage components like inverters, onboard chargers, and DC fast chargers.</p> <a href="#" class="text-sm font-medium ni-text-blue hover:underline">Learn More &rarr;</a> </div>
            `;
        }

        function getUpdatedRecommendationsHTML() {
             // Returns HTML for the 4 recommendations
            return `
                <div class="grid grid-cols-2 gap-4">
                    <div class="mb-4 animate-fade-in bg-white p-3 rounded shadow"> <img src="https://ni.scene7.com/is/image/ni/9300-high-voltage-battery-test-system-front-left-2022_480x256?scl=1" alt="High Voltage DC Cycler" class="w-full h-24 object-contain rounded mb-2"> <h4 class="font-semibold text-gray-800 text-sm">High-Voltage DC Cycler and Emulator</h4> <p class="text-xs ni-text-blue mb-1 leading-tight">Offers modular, regenerative battery pack test systems with a power range spanning from 100 kW to 2.4 MW.</p> <a href="#" class="text-xs font-medium ni-text-blue hover:underline">Learn More &rarr;</a> </div>
                    <div class="mb-4 animate-fade-in bg-white p-3 rounded shadow" style="animation-delay: 0.1s;"> <img src="https://ni.scene7.com/is/image/ni/HPS-17000+Render-Angled_480x256?scl=1" alt="HPS-17000" class="w-full h-24 object-contain rounded mb-2"> <h4 class="font-semibold text-gray-800 text-sm">HPS-17000 Battery Cycler and Emulator</h4> <p class="text-xs ni-text-blue mb-1 leading-tight">Test and validate EV battery packs up to 1,500 volts with low- and high-voltage modes, reliably correlate cycler actions with measurements...</p> <a href="#" class="text-sm font-medium ni-text-blue hover:underline">Learn More &rarr;</a> </div>
                    <div class="mb-4 animate-fade-in bg-white p-3 rounded shadow" style="animation-delay: 0.2s;"> <img src="https://ni.scene7.com/is/image/ni/NHR_4800_Cycler_480x256?scl=1" alt="Mid-Voltage DC Cycler" class="w-full h-24 object-contain rounded mb-2"> <h4 class="font-semibold text-gray-800 text-sm">Mid-Voltage DC Cycler and Emulator</h4> <p class="text-xs ni-text-blue mb-1 leading-tight">Serves as a multifunction solution for battery cycling and emulation for low- to medium-power applications...</p> <a href="#" class="text-sm font-medium ni-text-blue hover:underline">Learn More &rarr;</a> </div>
                    <div class="mb-4 animate-fade-in bg-white p-3 rounded shadow" style="animation-delay: 0.3s;"> <img src="https://ni.scene7.com/is/image/ni/9510-regenerative-grid-simulator-front-left_480x256?scl=1" alt="Regenerative Grid Simulator" class="w-full h-24 object-contain rounded mb-2"> <h4 class="font-semibold text-gray-800 text-sm">Regenerative Grid Simulator</h4> <p class="text-xs ni-text-blue mb-1 leading-tight">Offers capabilities for grid-tied inverter testing, vehicle to grid testing, AC power product testing, and more.</p> <a href="#" class="text-sm font-medium ni-text-blue hover:underline">Learn More &rarr;</a> </div>
                </div>
            `;
        }
        
         function getSpecsRecommendationsHTML() {
              // Returns HTML for the final 3 recommendations (specs)
             return `
                 <h3 class="text-lg font-semibold ni-text-blue mb-4 sticky top-0 bg-gray-50 pb-2">Technical High-Voltage Battery Test System Highlights</h3>
                 <div class="space-y-4"> 
                     <div class="animate-fade-in bg-white p-3 rounded shadow flex flex-col"> 
                         <img src="https://ni.scene7.com/is/image/ni/2549624_nhr_9300_high_voltage_battery_test_system_960x540?fmt=png-alpha&scl=1" alt="NHR-9300" class="w-full h-24 object-contain rounded mb-2"> 
                         <h4 class="font-semibold text-gray-800 text-sm mt-auto">NHR-9300</h4> 
                         <ul class="text-xs ni-text-blue list-disc list-inside space-y-1 mt-1 mb-2 leading-tight flex-grow">
                            <li>Right-sized 100 kW modules scalable to 2.4 MW/8,000 A</li>
                            <li>Wide operating envelope, dual range 600 V, 1200 V</li>
                            <li>Regenerative power >90 percent energy efficiency</li>
                            <li>Bidirectional DC source and load</li>
                            <li>Current, voltage, and mode transitions <2 ms</li>
                            <li>Battery emulation mode</li>
                            <li>Built-in digital measurements with charting and scope displays</li>
                         </ul>
                         <a href="#" class="datasheet-button self-center">Download datasheet</a> 
                     </div>
                     <div class="animate-fade-in bg-white p-3 rounded shadow flex flex-col" style="animation-delay: 0.1s;"> 
                         <img src="https://ni.scene7.com/is/image/ni/NI_ERS_BIC_960x540?fmt=png-alpha&scl=1" alt="ERS-BIC" class="w-full h-24 object-contain rounded mb-2"> 
                         <h4 class="font-semibold text-gray-800 text-sm mt-auto">ERS-BIC</h4> 
                         <ul class="text-xs ni-text-blue list-disc list-inside space-y-1 mt-1 mb-2 leading-tight flex-grow">
                            <li>Right-sized 600kW modules scalable to 2.4MW</li>
                            <li>Up to 180% overload capacity with fast recovery times</li>
                            <li>Wide operating envelope 0 V to 1,500 V</li>
                            <li>High dynamic DC source and load with energy recovery</li>
                            <li>Optimized operation modes for 400 V/800 V class</li>
                            <li>Output floated and short-circuit proof</li>
                            <li>Voltage, current, or output control</li>
                            <li>Water-cooling system for lower operating noise and low heat transmissions</li>
                         </ul>
                         <a href="#" class="datasheet-button self-center">Download datasheet</a> 
                     </div>
                     <div class="animate-fade-in bg-white p-3 rounded shadow flex flex-col" style="animation-delay: 0.2s;"> 
                         <img src="https://ni.scene7.com/is/image/ni/NI_HPS_17000_16x9?fmt=png-alpha&scl=1" alt="HPS-17000" class="w-full h-24 object-contain rounded mb-2"> 
                         <h4 class="font-semibold text-gray-800 text-sm mt-auto">HPS-17000</h4> 
                         <ul class="text-xs ni-text-blue list-disc list-inside space-y-1 mt-1 mb-2 leading-tight flex-grow">
                             <li>Right-sized 150kW modules scalable to 1.5 MW</li>
                             <li>Wide operating envelope 400 V to 1,500 V</li>
                             <li>Parallel cycler operation without physical proximity</li>
                             <li>AC and DC overcurrent protection</li>
                             <li>EMI filter</li>
                             <li>Grid interface</li>
                             <li>Modular design and swappable power bricks</li>
                         </ul>
                         <a href="#" class="datasheet-button self-center">Download datasheet</a> 
                     </div>
                 </div>
             `;
         }


        // --- UPDATED Function to handle timing for FIRST interaction ---
        function updateRecommendationsAndContinueChat() {
            // Show thinking indicator immediately
            const thinkingIndicator = showThinkingIndicator(); 
            
            // Add 2 second pause BEFORE agent starts typing
            setTimeout(() => {
                // Prepare the function that will animate/update the panel
                const startPanelUpdate = () => {
                    // Expand container
                    combinedPanelsContainer.classList.remove('md:w-2/5', 'max-w-2xl');
                    combinedPanelsContainer.classList.add('md:w-3/5', 'max-w-4xl');
                    // Expand recommendations panel
                    recommendationsPanel.classList.remove('w-1/2');
                    recommendationsPanel.classList.add('w-2/3');
                    // Shrink chat panel
                    chatPanel.classList.remove('w-1/2');
                    chatPanel.classList.add('w-1/3');
                    // Update recommendations content to 4 items
                    recommendationsContent.innerHTML = getUpdatedRecommendationsHTML();
                };
                
                // Start agent typing response (Step 2), passing callbacks
                runStep(2, thinkingIndicator, startPanelUpdate); 

            }, 2000); // 2 second thinking pause
        }

         // --- UPDATED Function to handle timing for SECOND interaction ---
         function showSpecsAndFinalRecs() {
            // Show thinking indicator immediately
            const thinkingIndicator = showThinkingIndicator(); 
            
            // Add 2 second pause BEFORE agent starts typing
            setTimeout(() => {
                // Prepare the function that will update panel content (no resize needed)
                const startPanelUpdate = () => {
                    recommendationsContent.innerHTML = getSpecsRecommendationsHTML(); 
                };
                
                // Start agent typing response (Step 32), passing callbacks
                runStep(32, thinkingIndicator, startPanelUpdate); 

            }, 2000); // 2 second thinking pause
        }


        // --- UPDATED DEMO SCRIPT ---
        function runStep(step, indicatorElementToRemove = null, onTypingStartCallback = null) {
            currentStep = step; 

            switch (step) {
                // Step 1 is skipped
                case 1: break; 

                case 1.5: // Agent Response + CTA (STATIC)
                    const ctaIntro = "Great, I can help with exploring our EV battery test solutions. Here's where you can find more information:";
                    addAgentMessage(ctaIntro); 
                    addCTAMessage("", "EV Battery Testing Solutions", "https://ni-adaptive-website-demo-edd7ba489258.herokuapp.com/battery.html"); 
                    runStep(1.6); 
                    break;
                
                case 1.6: // Agent Follow-up Question (STATIC) - Waits for user input
                    const challengeQuestion = "What's your primary challenge: performance validation, lifecycle testing, or end-of-line manufacturing?";
                    addAgentMessage(challengeQuestion);
                    // DO NOT show options here, wait for user input
                    break;

                // --- Step 2 triggered after delay by updateRecommendationsAndContinueChat ---
                case 2: 
                    const validationResponse = "Understood. Lifecycle validation is a core strength. Our PXI-based systems are the industry standard for this. Based on your goal, I can pull up specifications for our High-Voltage Battery Cycler, or would you prefer to see an application note on 'Simulating Real-World Driving Profiles'?";
                    chatOptions.innerHTML = ''; 
                    // Type response, then pause (onComplete is null)
                    typeAgentMessage(validationResponse, null, indicatorElementToRemove, onTypingStartCallback); 
                    break;

                 // --- Step 32 triggered after delay by showSpecsAndFinalRecs ---
                 case 32: 
                     const specsResponse = "Here are the key specifications for the High-Voltage Battery Test Systems. I've populated the content panel on your right with more details, including compatible chassis and software.";
                     chatOptions.innerHTML = ''; 
                     // Type the response, pass indicator and panel update callback
                     // After typing, wait 1s then ask about meeting (step 33)
                     typeAgentMessage(specsResponse, () => {
                         setTimeout(() => { runStep(33); }, 1000); 
                     }, indicatorElementToRemove, onTypingStartCallback); 
                     break;

                 // --- Step 33 after showing specs ---
                 case 33:
                     const meetingQuestion = "Would you like me to schedule a meeting with a Sales rep?";
                     // Type the question, then show buttons
                     typeAgentMessage(meetingQuestion, () => {
                         showOptions([
                             { text: 'Yes, connect me', nextStep: 10 },
                             { text: 'Maybe later', nextStep: 99 } 
                         ]);
                     });
                     break;

                // --- Other steps remain reachable via potential future button clicks ---               
                case 3: // Products Path (Less likely now)
                case 30: // EV Test info (Less likely now)
                case 31: // Case Study Path
                // case 32: // Repurposed above
                case 40: // PXI Path
                case 41: // Software Path
                case 42: // PXI Details
                case 43: // Demo Link
                case 10: // Connect Sales Start
                case 10.1: // Connect Sales Confirm
                case 99: // Start Over / Maybe Later
                case 100: // Done
                    // (Simplified for brevity, ensure all addAgentMessage calls)
                     if (step === 3) { /* ... */ }
                    else if (step === 30) { /* ... */ }
                    else if (step === 31) {
                        addAgentMessage("Great choice. Here is a recent case study...");
                        const caseStudyHTML = getCaseStudyHTML_31(); 
                        addAgentMessage(caseStudyHTML); 
                        setTimeout(() => {
                            addAgentMessage("Would you like to see product specs or talk to sales?");
                            showOptions([ { text: 'Show Specs', nextStep: 32 }, { text: 'Connect me to Sales', nextStep: 10 }, { text: 'Back', nextStep: 99 } ]); 
                        }, 800); 
                    }
                    else if (step === 40) { /* ... */ }
                    else if (step === 41) { /* ... */ }
                    else if (step === 42) { /* ... */ }
                    else if (step === 43) { /* ... */ }
                    else if (step === 10) {
                         addAgentMessage("Great! Connecting you with a sales rep...");
                         addAgentMessage("Please enter your name, company, and email...");
                         setTimeout(() => {
                             const formHTML = getFormHTML_10(); 
                             addUserMessage(formHTML); 
                             runStep(10.1); 
                         }, 2500); 
                    }
                    else if (step === 10.1) {
                         addAgentMessage("Thank you, Raj! A sales representative will reach out...");
                         setTimeout(() => {
                             addAgentMessage("Is there anything else I can help you with?");
                             showOptions([{ text: 'Start Over', nextStep: 99 }, { text: 'No, I\'m done', nextStep: 100 }]);
                         }, 1000);
                    }
                    else if (step === 99) { // Maybe Later / Start Over
                         addAgentMessage("Okay, is there anything else I can help you with?");
                         showOptions([{ text: 'Yes, connect me', nextStep: 10 }, { text: 'No, I\'m done', nextStep: 100 }]);
                    }
                    else if (step === 100) {
                         addAgentMessage("Thank you for using the NI Solution Finder! Have a great day...");
                         chatOptions.innerHTML = `<button onclick="resetDemo()" class="chat-option bg-gray-200">Reset Demo</button>`;
                    }
                    break;
            }
        }

        // --- Helper functions for HTML content ---
        // (getCaseStudyHTML_31, getPxiHTML_42, getDemoHTML_43, getFormHTML_10 remain unchanged)
        function getCaseStudyHTML_31() { return `<div class="p-3 bg-white rounded-lg border border-gray-200"><img src="https://ni.scene7.com/is/image/ni/AdobeStock_236859072_logo_539x399?scl=1" alt="BMW Group" class="w-full h-32 object-cover rounded mb-2"><h4 class="font-semibold text-gray-900">Shifting Left in Validation</h4><p class="text-sm text-gray-700">The BMW Group is using a digital twin approach to identify design weaknesses earlier.</p><a href="#" class="text-sm font-medium ni-text-blue hover:underline" target="_blank">Read the full story &rarr;</a></div>`; }
        function getPxiHTML_42() { return `<div class="p-3 bg-white rounded-lg border border-gray-200"><h4 class="font-semibold ni-text-blue">PXI Product Families</h4><ul class="list-disc list-inside text-sm text-gray-700 mt-2"><li><b>Chassis:</b> The backbone of your system.</li><li><b>Controllers:</b> Embedded or remote control.</li><li><b>Modules:</b> Hundreds of modules for I/O, instrumentation, and timing.</li></ul><a href="#" class="text-sm font-medium ni-text-blue hover:underline" target="_blank">Browse all PXI hardware &rarr;</a></div>`; }
        function getDemoHTML_43() { return `<div class="p-3 bg-white rounded-lg border border-gray-200"><img src="https://placehold.co/400x200/003c71/9fcd3a?text=LabVIEW+Demo" alt="LabVIEW Demo" class="w-full h-32 object-cover rounded mb-2"><h4 class="font-semibold text-gray-900">LabVIEW in 5 Minutes</h4><a href="#" class="text-sm font-medium ni-text-blue hover:underline" target="_blank">Watch the video &rarr;</a></div>`; }
        function getFormHTML_10() { return `<div class="p-3 bg-gray-100 rounded-lg border border-gray-200 text-sm"><p><b>Name:</b> Raj Singh</p><p><b>Company:</b> Tier 1 Automotive</p><p><b>Email:</b> raj.singh@tier1-auto.com</p></div>`; }
        
        // --- Page Personalization Logic ---
        function initializePersonalization() {
            const userProfile = { name: "Raj", industry: "Automotive", interest: "EV Battery Test" };
            heroHeadline.textContent = 'Accelerate Your EV Battery Validation';
            heroSubhead.textContent = 'Design and deploy comprehensive test systems for every stage of the battery lifecycle, from R&D to production.';
        }

        // Run personalization and auto-start demo
        document.addEventListener('DOMContentLoaded', () => {
             initializePersonalization();
             setTimeout(startDemo, 1000); 
        });
        
    </script>

</body>
</html>

